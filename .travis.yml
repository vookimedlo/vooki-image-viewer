# https://VookiImageViewer.cz

language: cpp
os:
  - linux
  - osx

sudo: required
dist: trusty

services:
  - docker

compiler:
  - clang
  - gcc

env:
  matrix:
    - QT=5.10 BREW=@5.10 PPA=beineri/opt-qt593-trusty

before_install:
  - '[ "$TRAVIS_OS_NAME" != linux ] || docker pull vookimedlo/ubuntu-qt:"$QT"_"$CC"_xenial'
  # Ugly hack (next 2 lines) to workaround the host OS misconfiguration while using clang.
  #- '[[ "$TRAVIS_OS_NAME" != linux  || "$CXX" != clang++ ]] || sudo apt-get install libc++-dev'
  #- '[[ "$TRAVIS_OS_NAME" != linux  || "$CXX" != clang++ ]] || export CXX="clang++ -stdlib=libc++"'

  - '[ "$TRAVIS_OS_NAME" != osx ] || brew update'
  - '[ "$TRAVIS_OS_NAME" != osx ] || brew install qt$BREW'
  - '[ "$TRAVIS_OS_NAME" != osx ] || brew link --force qt$BREW'
  - '[ "$TRAVIS_OS_NAME" != osx ] || export CMAKE_PREFIX_PATH=/usr/local/opt/qt/'

  - qmake -v
  - cmake --version

script:
  - '[ "$TRAVIS_OS_NAME" != linux ] || apt-get update -qq && apt-get install libraw-dev'
  - '[ "$TRAVIS_OS_NAME" != linux ] || cd build/cmake/unix'
  - '[ "$TRAVIS_OS_NAME" != osx ] || cd build/cmake/mac'
  - mkdir build
  - cd build
  - cmake -DCMAKE_BUILD_TYPE=Release ../../
  - make
