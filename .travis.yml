# https://VookiImageViewer.cz

language: cpp
os:
  - linux
  - osx

sudo: required
dist: trusty

services:
  - docker

compiler:
  - clang
  - gcc

env:
  matrix:
    - QT=5.10 BREW=@5.10

before_install:
  - '[ "$TRAVIS_OS_NAME" != linux ] || docker pull vookimedlo/ubuntu-qt:"$QT"_"$CC"_xenial'
  - '[ "$TRAVIS_OS_NAME" != linux ] || docker run -d --name ubuntu_bash --rm -ti vookimedlo/ubuntu-qt:"$QT"_"$CC"_xenial bash'
  - '[ "$TRAVIS_OS_NAME" != linux ] || docker exec ubuntu_bash apt-get update -qq'
  - '[ "$TRAVIS_OS_NAME" != linux ] || docker exec ubuntu_bash apt-get -y install libraw-dev'
  - '[ "$TRAVIS_OS_NAME" != linux ] || docker exec ubuntu_bash mkdir /root/sources'
  - '[ "$TRAVIS_OS_NAME" != linux ] || docker cp -L ./ ubuntu_bash:/root/sources'
  

# Ugly hack (next 2 lines) to workaround the host OS misconfiguration while using clang.
  #- '[[ "$TRAVIS_OS_NAME" != linux  || "$CXX" != clang++ ]] || sudo apt-get install libc++-dev'
  #- '[[ "$TRAVIS_OS_NAME" != linux  || "$CXX" != clang++ ]] || export CXX="clang++ -stdlib=libc++"'
  - '[ "$TRAVIS_OS_NAME" != osx ] || brew update'
  - '[ "$TRAVIS_OS_NAME" != osx ] || brew install qt$BREW'
  - '[ "$TRAVIS_OS_NAME" != osx ] || brew link --force qt$BREW'
  - '[ "$TRAVIS_OS_NAME" != osx ] || export CMAKE_PREFIX_PATH=/usr/local/opt/qt/'

  - qmake -v
  - cmake --version

script:
  - '[ "$TRAVIS_OS_NAME" != osx ] || cd build/cmake/mac'
  - '[ "$TRAVIS_OS_NAME" != osx ] || mkdir build'
  - '[ "$TRAVIS_OS_NAME" != osx ] || cd build'
  - '[ "$TRAVIS_OS_NAME" != osx ] || cmake -DCMAKE_BUILD_TYPE=Release ../../'
  - '[ "$TRAVIS_OS_NAME" != osx ] || make'
  
  - '[ "$TRAVIS_OS_NAME" != linux ] || docker exec ubuntu_bash bash -c "source /etc/profile && cd /root/sources/build/cmake/unix && ./generate.sh && cd build && make"'

      
